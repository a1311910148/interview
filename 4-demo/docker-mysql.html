<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker部署MySQL服务 | 我的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="XXX">
    
    <link rel="preload" href="/interview/assets/css/0.styles.7bcb96c2.css" as="style"><link rel="preload" href="/interview/assets/js/app.8b7001fa.js" as="script"><link rel="preload" href="/interview/assets/js/3.09e61146.js" as="script"><link rel="preload" href="/interview/assets/js/1.645caf6f.js" as="script"><link rel="preload" href="/interview/assets/js/28.c59f7355.js" as="script"><link rel="prefetch" href="/interview/assets/js/10.2850c218.js"><link rel="prefetch" href="/interview/assets/js/11.d385cf98.js"><link rel="prefetch" href="/interview/assets/js/12.d30c7716.js"><link rel="prefetch" href="/interview/assets/js/13.aa59dd2b.js"><link rel="prefetch" href="/interview/assets/js/14.30c19909.js"><link rel="prefetch" href="/interview/assets/js/15.f6ae54d5.js"><link rel="prefetch" href="/interview/assets/js/16.cf6e60f2.js"><link rel="prefetch" href="/interview/assets/js/17.25b3e831.js"><link rel="prefetch" href="/interview/assets/js/18.54c0ddbe.js"><link rel="prefetch" href="/interview/assets/js/19.b825fdc2.js"><link rel="prefetch" href="/interview/assets/js/20.cd5870ba.js"><link rel="prefetch" href="/interview/assets/js/21.71580b2c.js"><link rel="prefetch" href="/interview/assets/js/22.cced48d7.js"><link rel="prefetch" href="/interview/assets/js/23.c5228822.js"><link rel="prefetch" href="/interview/assets/js/24.478e72eb.js"><link rel="prefetch" href="/interview/assets/js/25.3192440f.js"><link rel="prefetch" href="/interview/assets/js/26.8ed0b81c.js"><link rel="prefetch" href="/interview/assets/js/27.4532e80e.js"><link rel="prefetch" href="/interview/assets/js/29.d0784306.js"><link rel="prefetch" href="/interview/assets/js/30.72641b5f.js"><link rel="prefetch" href="/interview/assets/js/31.6e4c0475.js"><link rel="prefetch" href="/interview/assets/js/32.8e3cf05d.js"><link rel="prefetch" href="/interview/assets/js/33.d3688fde.js"><link rel="prefetch" href="/interview/assets/js/34.5da46ad9.js"><link rel="prefetch" href="/interview/assets/js/35.bb67e589.js"><link rel="prefetch" href="/interview/assets/js/36.3f091898.js"><link rel="prefetch" href="/interview/assets/js/37.ccba1dd6.js"><link rel="prefetch" href="/interview/assets/js/38.55bad300.js"><link rel="prefetch" href="/interview/assets/js/39.1d680a34.js"><link rel="prefetch" href="/interview/assets/js/4.149f90e4.js"><link rel="prefetch" href="/interview/assets/js/5.c490b3e4.js"><link rel="prefetch" href="/interview/assets/js/6.7e5c0638.js"><link rel="prefetch" href="/interview/assets/js/7.458a7545.js"><link rel="prefetch" href="/interview/assets/js/8.093c9de9.js"><link rel="prefetch" href="/interview/assets/js/9.241cfaec.js">
    <link rel="stylesheet" href="/interview/assets/css/0.styles.7bcb96c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-6853d236><div data-v-6853d236><div class="password-shadow password-wrapper-out" style="display:none;" data-v-2d5d5590 data-v-6853d236 data-v-6853d236><h3 class="title" data-v-2d5d5590>我的博客</h3> <p class="description" data-v-2d5d5590>XXX</p> <label id="box" class="inputBox" data-v-2d5d5590><input type="password" value="" data-v-2d5d5590> <span data-v-2d5d5590>Konck! Knock!</span> <button data-v-2d5d5590>OK</button></label> <div class="footer" data-v-2d5d5590><span data-v-2d5d5590><i class="iconfont reco-theme" data-v-2d5d5590></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2d5d5590>vuePress-theme-reco</a></span> <span data-v-2d5d5590><i class="iconfont reco-copyright" data-v-2d5d5590></i> <a data-v-2d5d5590><!---->
          
        <!---->
        2022
      </a></span></div></div> <div class="hide" data-v-6853d236><header class="navbar" data-v-6853d236><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/interview/" class="home-link router-link-active"><!----> <span class="site-name">我的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      song的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/726107228492253" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/gemini-hjl" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-6853d236></div> <aside class="sidebar" data-v-6853d236><div class="personal-info-wrapper" data-v-3c280276 data-v-6853d236><!----> <!----> <div class="num" data-v-3c280276><div data-v-3c280276><h3 data-v-3c280276>22</h3> <h6 data-v-3c280276>文章</h6></div> <div data-v-3c280276><h3 data-v-3c280276>0</h3> <h6 data-v-3c280276>标签</h6></div></div> <ul class="social-links" data-v-3c280276></ul> <hr data-v-3c280276></div> <nav class="nav-links"><div class="nav-item"><a href="/interview/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      song的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/726107228492253" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/gemini-hjl" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/interview/" class="sidebar-heading clickable router-link-active"><span>欢迎学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/" aria-current="page" class="sidebar-link">博客简介</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/interview/1-base/css" class="sidebar-heading clickable"><span>web基础</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/interview/2-Vue/base" class="sidebar-heading clickable"><span>Vue框架</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/interview/3-node/Node-Modules" class="sidebar-heading clickable"><span>node服务端</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/interview/4-demo/puppeteerjs" class="sidebar-heading clickable open"><span>用例收集</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/4-demo/puppeteerjs.html" class="sidebar-link">node puppeteerjs模块爬取页面</a></li><li><a href="/interview/4-demo/docker-mysql.html" aria-current="page" class="active sidebar-link">Docker部署MySQL服务</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/interview/5-over-the-wall/internet" class="sidebar-heading clickable"><span>科学上网</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-2d5d5590 data-v-6853d236><h3 class="title" data-v-2d5d5590>Docker部署MySQL服务</h3> <!----> <label id="box" class="inputBox" data-v-2d5d5590><input type="password" value="" data-v-2d5d5590> <span data-v-2d5d5590>Konck! Knock!</span> <button data-v-2d5d5590>OK</button></label> <div class="footer" data-v-2d5d5590><span data-v-2d5d5590><i class="iconfont reco-theme" data-v-2d5d5590></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2d5d5590>vuePress-theme-reco</a></span> <span data-v-2d5d5590><i class="iconfont reco-copyright" data-v-2d5d5590></i> <a data-v-2d5d5590><!---->
          
        <!---->
        2022
      </a></span></div></div> <div data-v-6853d236><div data-v-6853d236><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">Docker部署MySQL服务</h1> <div data-v-305db890><i class="iconfont reco-account" data-v-305db890><span data-v-305db890>codinglin</span></i> <i class="iconfont reco-date" data-v-305db890><span data-v-305db890>2022/8/28</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#查找配置文件位置">查找配置文件位置</a></li><li><a href="#查找数据文件位置">查找数据文件位置</a></li><li><a href="#创建本地路径">创建本地路径</a></li><li><a href="#挂载启动mysql">挂载启动MySQL</a><ul><li><a href="#mysql-root-password">MYSQL_ROOT_PASSWORD</a></li><li><a href="#mysql-database">MYSQL_DATABASE</a></li><li><a href="#mysql-user-mysql-password">MYSQL_USER, MYSQL_PASSWORD</a></li><li><a href="#mysql-allow-empty-password">MYSQL_ALLOW_EMPTY_PASSWORD</a></li><li><a href="#mysql-random-root-password">MYSQL_RANDOM_ROOT_PASSWORD</a></li><li><a href="#mysql-onetime-password">MYSQL_ONETIME_PASSWORD</a></li><li><a href="#mysql-initdb-skip-tzinfo">MYSQL_INITDB_SKIP_TZINFO</a></li></ul></li><li><a href="#创建数据库转储">创建数据库转储</a></li><li><a href="#从转储文件中恢复数据">从转储文件中恢复数据</a></li><li><a href="#docker容器-查看、停止、删除容器-https-nkcoder-github-io-posts-docker-docker-container-list-stop-remove">Docker容器：查看、停止、删除容器</a><ul><li><a href="#查看容器">查看容器</a></li><li><a href="#停止容器">停止容器</a></li><li><a href="#删除容器">删除容器</a></li><li><a href="#reference-docs">reference docs:</a></li></ul></li></ul></div><p></p> <h1 id="安装部署环境"><a href="#安装部署环境" class="header-anchor">#</a> 安装部署环境</h1> <ul><li>Ubuntu 20.04.1 LTS</li> <li>Docker 20.10.11</li> <li>MySQL latest(8.0.27)</li></ul> <h1 id="下载镜像"><a href="#下载镜像" class="header-anchor">#</a> 下载镜像</h1> <p>从仓库中拉取<code>mysql</code>镜像，如果没加标签的话，默认获取最新版本（latest）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> pull mysql:tag
复制代码
</code></pre></div><h1 id="简单启动-mysql服务器"><a href="#简单启动-mysql服务器" class="header-anchor">#</a> 简单启动 MySQL服务器</h1> <p>启动 MySQL 实例很简单：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">--name</span> some-mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token string">'my-secret-pw'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> mysql:tag
复制代码
</code></pre></div><ul><li><code>some-mysql</code>：分配给容器的名称</li> <li><code>root</code>：为root用户设置的密码</li> <li><code>tag</code>：<code>mysql</code>镜像标签</li></ul> <h1 id="挂载数据卷以及配置文件启动"><a href="#挂载数据卷以及配置文件启动" class="header-anchor">#</a> 挂载数据卷以及配置文件启动</h1> <h2 id="查找配置文件位置"><a href="#查找配置文件位置" class="header-anchor">#</a> 查找配置文件位置</h2> <p>不同版本部署的 MySQL 内，可能文件路径不一致，如 <code>/etc/mysql/my.cnf</code>、 <code>/etc/mysql/conf.d</code> 或者 <code>/etc/mysql/mysql.conf.d</code>等。运行以下命令查找<code>mysql</code>配置文件<code>my.cnf</code>的位置：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">--rm</span> mysql mysql <span class="token parameter variable">--help</span> <span class="token operator">|</span> <span class="token function">grep</span> my.cnf
复制代码
</code></pre></div><p>得到结果：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>                      order of preference, my.cnf, <span class="token variable">$MYSQL_TCP_PORT</span>,
/etc/my.cnf /etc/mysql/my.cnf ~/.my.cnf
复制代码
</code></pre></div><p>意思是按照<code>/etc/my.cnf</code>、<code>/etc/mysql/my.cnf</code>、<code>~/.my.cnf</code>路径按优先排序。</p> <p>依次访问上述路径：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">--rm</span> mysql <span class="token function">cat</span> /etc/my.cnf
cat: /etc/my.cnf: No such <span class="token function">file</span> or directory

$ <span class="token function">docker</span> run <span class="token parameter variable">--rm</span> mysql <span class="token function">cat</span> /etc/mysql/my.cnf
<span class="token comment"># Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="token comment">#</span>
<span class="token comment"># This program is free software; you can redistribute it and/or modify</span>
<span class="token punctuation">..</span>.
复制代码
</code></pre></div><p>可以得到镜像中<code>mysql</code>配置文件路径为<code>/etc/mysql/my.cnf</code></p> <h2 id="查找数据文件位置"><a href="#查找数据文件位置" class="header-anchor">#</a> 查找数据文件位置</h2> <p>运行以下命令查看<code>mysql</code>镜像信息：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> inspect mysql
复制代码
</code></pre></div><p>得到结果：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">..</span>.
            <span class="token string">&quot;Volumes&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;/var/lib/mysql&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>,
<span class="token punctuation">..</span>.
复制代码
</code></pre></div><p>可以得到<code>mysql</code>挂载的数据文件路径为<code>/var/lib/mysql</code></p> <h2 id="创建本地路径"><a href="#创建本地路径" class="header-anchor">#</a> 创建本地路径</h2> <p>在物理机上，创建指定数据和配置文件的挂载路径（须在docker进程有写权限的目录下，如<code>/home/docker</code>）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/docker/mysql/conf <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/docker/mysql/datadir
复制代码
</code></pre></div><p>将容器的<code>mysql</code>默认配置文件<code>/etc/mysql/my.cnf</code>拷贝出来</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token assign-left variable">CID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> mysql<span class="token variable">`</span></span> <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">docker</span> <span class="token function">cp</span> <span class="token variable">$CID</span>:/etc/mysql/my.cnf /home/docker/mysql/conf <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">docker</span> stop <span class="token variable">$CID</span> <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable">$CID</span>
复制代码
</code></pre></div><h2 id="挂载启动mysql"><a href="#挂载启动mysql" class="header-anchor">#</a> 挂载启动MySQL</h2> <p>知道了<code>mysql</code>配置文件和数据文件位置，就可以挂载启动<code>mysql</code>服务了</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">--name</span> some-mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>my-secret-pw <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /home/docker/mysql/conf/my.cnf:/etc/my.cnf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /home/docker/mysql/datadir:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>on-failure:3 <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> mysql
复制代码
</code></pre></div><ul><li><strong>--name</strong>：为容器指定一个名字</li> <li><strong>-p</strong>：指定端口映射，格式为：<strong>主机(宿主)端口:容器端口</strong></li> <li><strong>-e</strong>：设置环境变量</li> <li><strong>--restart=on-failure:3</strong>：是指容器在未来出现异常退出（退出码非0）的情况下循环重启3次</li> <li><strong>--mount</strong>：目录挂载</li> <li><strong>-d</strong>：后台运行容器，并返回容器 id</li></ul> <h1 id="mysql-命令行客户端"><a href="#mysql-命令行客户端" class="header-anchor">#</a> MySQL 命令行客户端</h1> <p>命令启动另一个<code>mysql</code>容器实例进入命令行客户端：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> mysql mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-hsome.mysql.host</span> -usome-mysql-user <span class="token parameter variable">-p</span>
复制代码
</code></pre></div><h1 id="查看mysql日志"><a href="#查看mysql日志" class="header-anchor">#</a> 查看MySQL日志</h1> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> logs some-mysql
复制代码
</code></pre></div><h1 id="环境变量说明"><a href="#环境变量说明" class="header-anchor">#</a> 环境变量说明</h1> <p>在启动<code>mysql</code>镜像时，可以通过在<code>docker run</code>命令行中传递一个或多个环境变量来调整 MySQL 实例的配置。请注意，如果您使用已经包含数据库的数据目录启动容器，则以下任何变量都不会产生任何影响：在容器启动时，任何预先存在的数据库将始终保持不变。</p> <h3 id="mysql-root-password"><a href="#mysql-root-password" class="header-anchor">#</a> <code>MYSQL_ROOT_PASSWORD</code></h3> <p>此变量是必需的，它指定将为 MySQL<code>root</code>超级用户帐户设置的密码。在上面的例子中，它被设置为<code>root</code>。</p> <h3 id="mysql-database"><a href="#mysql-database" class="header-anchor">#</a> <code>MYSQL_DATABASE</code></h3> <p>此变量是可选的，允许您指定要在映像启动时创建的数据库的名称。如果提供了用户/密码（见下文），则该用户将被授予对该数据库的超级用户访问权限（<a href="https://link.juejin.cn?target=http%3A%2F%2Fdev.mysql.com%2Fdoc%2Fen%2Fadding-users.html" target="_blank" rel="noopener noreferrer">对应于<code>GRANT ALL</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）。</p> <h3 id="mysql-user-mysql-password"><a href="#mysql-user-mysql-password" class="header-anchor">#</a> <code>MYSQL_USER</code>, <code>MYSQL_PASSWORD</code></h3> <p>这些变量是可选的，结合使用来创建新用户和设置该用户的密码。该用户将被授予对<code>MYSQL_DATABASE</code>变量指定的数据库的超级用户权限（见上文）。</p> <h3 id="mysql-allow-empty-password"><a href="#mysql-allow-empty-password" class="header-anchor">#</a> <code>MYSQL_ALLOW_EMPTY_PASSWORD</code></h3> <p>这是一个可选变量。设置为非空值，例如<code>yes</code>，以允许使用 root 用户的空白密码启动容器。</p> <h3 id="mysql-random-root-password"><a href="#mysql-random-root-password" class="header-anchor">#</a> <code>MYSQL_RANDOM_ROOT_PASSWORD</code></h3> <p>这是一个可选变量。设置为非空值，如<code>yes</code>，为 root 用户生成随机初始密码（使用<code>pwgen</code>）。生成的 root 密码将打印到控制台 ( <code>GENERATED ROOT PASSWORD: .....</code>)。</p> <h3 id="mysql-onetime-password"><a href="#mysql-onetime-password" class="header-anchor">#</a> <code>MYSQL_ONETIME_PASSWORD</code></h3> <p>初始化完成后，将root（<em>不是</em>在<code>MYSQL_USER</code>! 中指定的用户）用户设置为过期，强制在首次登录时更改密码。任何非空值都将激活此设置。<em>注意</em>：此功能仅在 MySQL 5.6+ 上受支持。在 MySQL 5.5 上使用此选项将在初始化期间引发适当的错误。</p> <h3 id="mysql-initdb-skip-tzinfo"><a href="#mysql-initdb-skip-tzinfo" class="header-anchor">#</a> <code>MYSQL_INITDB_SKIP_TZINFO</code></h3> <p>默认情况下，入口点脚本会自动加载<code>CONVERT_TZ()</code>函数所需的时区数据。如果不需要，任何非空值都会禁用时区加载。</p> <h1 id="备份和恢复"><a href="#备份和恢复" class="header-anchor">#</a> 备份和恢复</h1> <h2 id="创建数据库转储"><a href="#创建数据库转储" class="header-anchor">#</a> 创建数据库转储</h2> <p>启动<code>mysql</code>镜像使用<code>mysqldump</code>命令备份：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> some-mysql <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'exec mysqldump --all-databases -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;'</span> <span class="token operator">&gt;</span> /some/path/on/your/host/all-databases.sql
复制代码
</code></pre></div><h2 id="从转储文件中恢复数据"><a href="#从转储文件中恢复数据" class="header-anchor">#</a> 从转储文件中恢复数据</h2> <p>启动<code>mysql</code>镜像执行<code>.sql</code>文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> some-mysql <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'exec mysql -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;'</span> <span class="token operator">&lt;</span> /some/path/on/your/host/all-databases.sql
复制代码
</code></pre></div><h2 id="docker容器-查看、停止、删除容器"><a href="#docker容器-查看、停止、删除容器" class="header-anchor">#</a> <a href="https://nkcoder.github.io/posts/docker/docker-container-list-stop-remove/" target="_blank" rel="noopener noreferrer">Docker容器：查看、停止、删除容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>July 9, 2020 3-minute read</p> <p><a href="https://nkcoder.github.io/categories/docker/" target="_blank" rel="noopener noreferrer">docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="查看容器"><a href="#查看容器" class="header-anchor">#</a> 查看容器</h3> <p>列出容器的命令为：<code>docker container ls</code>，等价的别名为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> container <span class="token function">ps</span>
<span class="token function">docker</span> container list
<span class="token function">docker</span> <span class="token function">ps</span>
</code></pre></div><p>常用的参数说明如下：</p> <ul><li><code>-a, --all</code>：列出所有的容器，包括停止运行的容器</li> <li><code>-s, --size</code>：显示容器的大小</li> <li><code>-q, --quiet</code>：仅显示容器ID</li> <li><code>-f, --filter</code>：过滤器，支持<code>key=value</code>的格式进行过滤，多个过滤器使用<code>-f &quot;key=value&quot; -f &quot;key=value&quot;</code>格式</li></ul> <p><code>-a</code>列出所有容器：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜  ~ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
CONTAINER ID        IMAGE                                                 COMMAND                  CREATED             STATUS                    PORTS                               NAMES
1c4bc2440cff        docker.elastic.co/elasticsearch/elasticsearch:7.7.0   <span class="token string">&quot;/tini -- /usr/local…&quot;</span>   <span class="token number">7</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">)</span> <span class="token number">5</span> days ago                                       sweet_lovelace
da242f09324e        mysql:8.0.19                                          <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> weeks ago         Up <span class="token number">15</span> minutes             <span class="token number">0.0</span>.0.0:3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, <span class="token number">33060</span>/tcp   freeimmi_mini_db_1
</code></pre></div><p><code>-s</code>列出容器的大小：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜  ~ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-s</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES                SIZE
da242f09324e        mysql:8.0.19        <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> weeks ago         Up <span class="token number">16</span> minutes       <span class="token number">0.0</span>.0.0:3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, <span class="token number">33060</span>/tcp   freeimmi_mini_db_1   105B <span class="token punctuation">(</span>virtual 547MB<span class="token punctuation">)</span>
</code></pre></div><blockquote><p><code>SIZE</code>列显示的是容器的<strong>可写层</strong>占用的空间，括号中的virtual表示容器镜像的<strong>只读层</strong>和容器的<strong>可写层</strong>总共占用的空间。</p></blockquote> <p><code>-q</code>仅显示容器ID：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜  ~ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-q</span>
da242f09324e
➜  ~ <span class="token function">docker</span> stop <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span>
1c4bc2440cff
da242f09324e
</code></pre></div><p><code>-f</code>可以通过容器名称（name）、退出状态（exited）、容器状态（status）、创建时间（before|since|after）等进行过滤：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜  ~ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-f</span> <span class="token string">'name=freeimmi_mini_db_1'</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES
da242f09324e        mysql:8.0.19        <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> weeks ago         Up <span class="token number">12</span> seconds       <span class="token number">0.0</span>.0.0:3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, <span class="token number">33060</span>/tcp   freeimmi_mini_db_1

➜  ~ <span class="token function">docker</span> stop freeimmi_mini_db_1
freeimmi_mini_db_1
➜  ~ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-f</span> <span class="token string">'exited=0'</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES
da242f09324e        mysql:8.0.19        <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> weeks ago         Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">48</span> seconds ago                       freeimmi_mini_db_1

➜  ~ <span class="token function">docker</span> start freeimmi_mini_db_1
freeimmi_mini_db_1
➜  ~ <span class="token function">docker</span> <span class="token function">kill</span> freeimmi_mini_db_1
freeimmi_mini_db_1
➜  ~ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-f</span> <span class="token string">'exited=137'</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                       PORTS               NAMES
da242f09324e        mysql:8.0.19        <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> weeks ago         Exited <span class="token punctuation">(</span><span class="token number">137</span><span class="token punctuation">)</span> <span class="token number">5</span> seconds ago                       freeimmi_mini_db_1
</code></pre></div><h3 id="停止容器"><a href="#停止容器" class="header-anchor">#</a> 停止容器</h3> <p>停止容器使用<code>docker container stop</code>或者<code>docker stop</code>命令，该命令会向容器内的主进程发送<code>SIGTERM</code>信号，等待一段时间后，再发送<code>SIGKILL</code>命令。</p> <p>可以使用<code>-t, --time</code>设置kill之前的等待时间，默认是10s：</p> <div class="language-fallback extra-class"><pre class="language-text"><code>➜  ~ docker container start freeimmi_mini_db_1
freeimmi_mini_db_1
➜  ~ docker stop -t 20 freeimmi_mini_db_1
freeimmi_mini_db_1
</code></pre></div><h3 id="删除容器"><a href="#删除容器" class="header-anchor">#</a> 删除容器</h3> <p>删除容器使用<code>docker container rm</code>或者<code>docker rm</code>命令。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜  ~ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
CONTAINER ID        IMAGE                                                 COMMAND                  CREATED             STATUS                     PORTS               NAMES
58a0b9865684        alpine                                                <span class="token string">&quot;/bin/sh&quot;</span>                <span class="token number">44</span> seconds ago      Up <span class="token number">43</span> seconds                                  my_alpine3
1c4bc2440cff        docker.elastic.co/elasticsearch/elasticsearch:7.7.0   <span class="token string">&quot;/tini -- /usr/local…&quot;</span>   <span class="token number">7</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">)</span> <span class="token number">5</span> days ago                        sweet_lovelace
da242f09324e        mysql:8.0.19                                          <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> weeks ago         Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">8</span> minutes ago                       freeimmi_mini_db_1
➜  ~ <span class="token function">docker</span> <span class="token function">rm</span> 1c4bc2440cff
1c4bc2440cff
</code></pre></div><p><code>docker rm</code>不能直接删除运行中的容器，可是使用<code>-f, --force</code>参数，表示强制删除，即直接向容器中的主进程发送<code>SIGKILL</code>信号，一般不推荐这么做，建议先使用<code>docker stop</code>停止容器，然后再使用<code>docker rm</code>删除容器，给容器留出一些时间进行清理等工作：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜  ~ <span class="token function">docker</span> <span class="token function">ps</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
58a0b9865684        alpine              <span class="token string">&quot;/bin/sh&quot;</span>           <span class="token number">2</span> minutes ago       Up <span class="token number">2</span> minutes                            my_alpine3
➜  ~ <span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> 58a0b9865684
58a0b9865684
</code></pre></div><p>删除所有停止的容器：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜  ~ <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span>
da242f09324e
</code></pre></div><p><code>-v</code>参数表示删除与容器关联的所有匿名的卷：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜  ~ <span class="token function">docker</span> create <span class="token parameter variable">-v</span> awesome:/foo <span class="token parameter variable">-v</span> /bar <span class="token parameter variable">--name</span> hell-redis redis
7da82099f278dd15c6ee16ea5a1e347feb1f3f45b9c8890c830cd7f095e1c63f
➜  ~ <span class="token function">docker</span> <span class="token function">ps</span>  <span class="token parameter variable">-a</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
7da82099f278        redis               <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> seconds ago       Created                                 hell-redis
➜  ~ <span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-v</span> hell-redis
hell-redis
➜  ~ <span class="token function">docker</span> volume <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> awesome
<span class="token builtin class-name">local</span>               awesome
</code></pre></div><p>删除容器，还可以使用<code>docker container prune</code>，表示删除所有停止的容器，<code>-f, --force</code>参数表示不需要交互式确认：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>➜  ~ <span class="token function">docker</span> container prune <span class="token parameter variable">-f</span>
Deleted Containers:
72a9df4be93f1fa11dc61d73ef48211b507949a1aaa0231a5ef0383cd61c4d45
73d22e04a8ae342174e0069029066d4f03f3a94b373b6d0c253654ee926592fb
44c829e75011bb913c7af9bf095ccec865084db1905a80dfacbb3e4b47209b17

Total reclaimed space: 0B
</code></pre></div><p><code>--filter</code>支持过滤，目前支持的过滤器有：<code>unitl(删除指定时间之前的容器)</code>和<code>label(删除指定标签的容器)</code>:</p> <div class="language-fallback extra-class"><pre class="language-text"><code>➜  ~ docker container prune -f --filter &quot;until=1m&quot;
Deleted Containers:
633cb0d9b525e7e595442e8545ef6458c9dbf342fd12c00616acd63ee73bcafb

Total reclaimed space: 0B
</code></pre></div><h3 id="reference-docs"><a href="#reference-docs" class="header-anchor">#</a> reference docs:</h3> <ul><li><a href="https://docs.docker.com/engine/reference/commandline/ps/" target="_blank" rel="noopener noreferrer">docker ps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.docker.com/engine/reference/commandline/stop/" target="_blank" rel="noopener noreferrer">docker stop<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.docker.com/engine/reference/commandline/rm/" target="_blank" rel="noopener noreferrer">docker rm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.docker.com/engine/reference/commandline/container_prune/" target="_blank" rel="noopener noreferrer">docker container prune<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/interview/4-demo/puppeteerjs.html" class="prev">
          node puppeteerjs模块爬取页面
        </a></span> <span class="next"><a href="/interview/5-over-the-wall/internet.html">
          三网线路
        </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-070bf1cb></ul></main></div> <!----></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/interview/assets/js/app.8b7001fa.js" defer></script><script src="/interview/assets/js/3.09e61146.js" defer></script><script src="/interview/assets/js/1.645caf6f.js" defer></script><script src="/interview/assets/js/28.c59f7355.js" defer></script>
  </body>
</html>
